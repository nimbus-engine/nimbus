<?xml version="1.0" encoding="utf-8"?>
<App Name="Cat Facts" 
     Width="700" Height="600" 
     Theme="Dark" 
     DarkMode="true"
     DevMode="true"
     Version="1.0.0"
     OnLoad="OnAppLoad">

    <UI>
        <Grid Background="#1A1A2E">
            <Grid.RowDefinitions>Auto,Auto,*,Auto</Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#16213E" Padding="20,15">
                <Grid>
                    <Grid.ColumnDefinitions>Auto,*,Auto</Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="ðŸ±" FontSize="36" VerticalAlignment="Center"/>
                    
                    <StackPanel Grid.Column="1" Margin="15,0,0,0" VerticalAlignment="Center">
                        <TextBlock Text="Cat Facts" FontSize="24" FontWeight="Bold" Foreground="#E94560"/>
                        <TextBlock Text="Random facts about cats" FontSize="12" Foreground="#888888"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Facts: " Foreground="#888888" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock Name="lblCount" Text="0" Foreground="#E94560" FontSize="13" FontWeight="Bold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Controls -->
            <Border Grid.Row="1" Background="#0F3460" Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>*,Auto,Auto,Auto</Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Name="lblStatus" Text="Ready" Foreground="#53D769" FontSize="13" VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Grid.Column="1" Name="btnGetFact" 
                            Content="  ðŸŽ² Random Fact  " 
                            Background="#E94560" Foreground="White"
                            Padding="15,8" FontSize="14" FontWeight="Bold"
                            Margin="5,0" onClick="OnGetRandomFact"/>

                    <Button Grid.Column="2" Name="btnGetAll" 
                            Content="  ðŸ“‹ Load All  " 
                            Background="#533483" Foreground="White"
                            Padding="15,8" FontSize="14"
                            Margin="5,0" onClick="OnGetAllFacts"/>

                    <Button Grid.Column="3" Name="btnClear" 
                            Content="  ðŸ—‘ Clear  " 
                            Background="#333333" Foreground="#AAAAAA"
                            Padding="15,8" FontSize="14"
                            Margin="5,0" onClick="OnClear"/>
                </Grid>
            </Border>

            <!-- Facts Display -->
            <Border Grid.Row="2" Background="#1A1A2E" Margin="15,10" 
                    BorderBrush="#2A2A4A" BorderThickness="1" CornerRadius="8">
                <Grid>
                    <ScrollViewer Name="scrollFacts" VerticalScrollBarVisibility="Auto" Padding="5">
                        <StackPanel Name="factsPanel" Margin="10">
                            
                            <!-- Welcome Card -->
                            <Border Name="welcomeCard" Background="#16213E" CornerRadius="10" Padding="25" Margin="0,5">
                                <StackPanel>
                                    <TextBlock Text="ðŸ± Welcome to Cat Facts!" FontSize="20" FontWeight="Bold" Foreground="#E94560" HorizontalAlignment="Center"/>
                                    <TextBlock Text="" FontSize="5"/>
                                    <TextBlock Text="Click 'Random Fact' to get a random cat fact" FontSize="14" Foreground="#888888" HorizontalAlignment="Center" TextWrapping="Wrap"/>
                                    <TextBlock Text="or 'Load All' to fetch multiple facts from the API" FontSize="14" Foreground="#888888" HorizontalAlignment="Center" TextWrapping="Wrap"/>
                                    <TextBlock Text="" FontSize="10"/>
                                    <Border Background="#0F3460" CornerRadius="6" Padding="10" HorizontalAlignment="Center">
                                        <TextBlock Text="API: cat-fact.herokuapp.com" FontSize="11" Foreground="#53D769" FontFamily="Consolas"/>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Fact Cards will be added here dynamically -->
                            <TextBlock Name="lblFact1" Text="" FontSize="14" Foreground="#D4D4D4" TextWrapping="Wrap" Margin="0,5"/>
                            <TextBlock Name="lblFact2" Text="" FontSize="14" Foreground="#D4D4D4" TextWrapping="Wrap" Margin="0,5"/>
                            <TextBlock Name="lblFact3" Text="" FontSize="14" Foreground="#D4D4D4" TextWrapping="Wrap" Margin="0,5"/>
                            <TextBlock Name="lblFact4" Text="" FontSize="14" Foreground="#D4D4D4" TextWrapping="Wrap" Margin="0,5"/>
                            <TextBlock Name="lblFact5" Text="" FontSize="14" Foreground="#D4D4D4" TextWrapping="Wrap" Margin="0,5"/>

                        </StackPanel>
                    </ScrollViewer>

                    <!-- Loading Overlay -->
                    <Border Name="loadingOverlay" Visibility="Collapsed" Background="#CC000000" CornerRadius="8">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ”„" FontSize="40" HorizontalAlignment="Center"/>
                            <TextBlock Text="Loading from API..." FontSize="16" Foreground="#E94560" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                            <TextBlock Name="lblLoadingUrl" Text="" FontSize="11" Foreground="#666666" HorizontalAlignment="Center" Margin="0,5,0,0" FontFamily="Consolas"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Footer -->
            <Border Grid.Row="3" Background="#16213E" Padding="15,8">
                <Grid>
                    <Grid.ColumnDefinitions>*,Auto</Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="Last response: " Foreground="#555555" FontSize="11"/>
                        <TextBlock Name="lblLastResponse" Text="none" Foreground="#888888" FontSize="11" FontFamily="Consolas"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock Text="Powered by " Foreground="#555555" FontSize="11"/>
                        <TextBlock Text="Nimbus Engine" Foreground="#E94560" FontSize="11" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </UI>

    <Shortcuts>
        <KeyBinding Key="F5" Handler="OnGetRandomFact"/>
        <KeyBinding Key="F6" Handler="OnGetAllFacts"/>
        <KeyBinding Key="Delete" Handler="OnClear"/>
    </Shortcuts>

    <Logic>
        <Var Name="factCount" Value="0" Type="int"/>
        <Var Name="httpResult" Value="" Type="string"/>
        <Var Name="currentFact" Value="" Type="string"/>
        <Var Name="apiBase" Value="https://cat-fact.herokuapp.com" Type="string"/>

        <Handler Name="OnAppLoad">
            <Set Target="lblStatus" Property="Text" Value="Ready - Press F5 for random fact"/>
            <Set Target="lblCount" Property="Text" Value="0"/>
        </Handler>

        <!-- Get Random Fact -->
        <Handler Name="OnGetRandomFact">
            <Set Target="lblStatus" Property="Text" Value="Fetching random fact..."/>
            <Set Target="lblStatus" Property="Foreground" Value="#FFAA00"/>
            <Set Target="lblLoadingUrl" Property="Text" Value="GET /facts/random"/>
            <Show Control="loadingOverlay"/>
            <Hide Control="welcomeCard"/>

            <HttpRequest 
                Method="GET" 
                Url="https://cat-fact.herokuapp.com/facts/random" 
                ToState="httpResult"
                ToControl="lblLastResponse"
                ToProperty="Text"/>

            <Hide Control="loadingOverlay"/>

            <Increment Var="factCount" By="1"/>
            <Set Target="lblCount" Property="Text" Value="{factCount}"/>

            <Call Handler="DisplayNewFact"/>

            <Set Target="lblStatus" Property="Text" Value="Fact loaded successfully!"/>
            <Set Target="lblStatus" Property="Foreground" Value="#53D769"/>
        </Handler>

        <!-- Display the fetched fact -->
        <Handler Name="DisplayNewFact">
            <If Condition="{factCount} == 1">
                <Set Target="lblFact1" Property="Text" Value="ðŸ± Fact #1:"/>
                <Set Target="lblFact1" Property="Foreground" Value="#E94560"/>
                <Set Target="lblFact2" Property="Text" Value="{httpResult}"/>
                <Set Target="lblFact2" Property="Foreground" Value="#D4D4D4"/>
            </If>
            <If Condition="{factCount} == 2">
                <Set Target="lblFact3" Property="Text" Value="ðŸ± Fact #2:"/>
                <Set Target="lblFact3" Property="Foreground" Value="#E94560"/>
                <Set Target="lblFact4" Property="Text" Value="{httpResult}"/>
                <Set Target="lblFact4" Property="Foreground" Value="#D4D4D4"/>
            </If>
            <If Condition="{factCount} >= 3">
                <Set Target="lblFact5" Property="Text" Value="ðŸ± Fact #{factCount}: {httpResult}"/>
                <Set Target="lblFact5" Property="Foreground" Value="#D4D4D4"/>
            </If>

            <ScrollToBottom Control="scrollFacts"/>
        </Handler>

        <!-- Get All Facts -->
        <Handler Name="OnGetAllFacts">
            <Set Target="lblStatus" Property="Text" Value="Loading all facts..."/>
            <Set Target="lblStatus" Property="Foreground" Value="#FFAA00"/>
            <Set Target="lblLoadingUrl" Property="Text" Value="GET /facts"/>
            <Show Control="loadingOverlay"/>
            <Hide Control="welcomeCard"/>

            <HttpRequest 
                Method="GET" 
                Url="https://cat-fact.herokuapp.com/facts" 
                ToState="httpResult"
                ToControl="lblLastResponse"
                ToProperty="Text"/>

            <Hide Control="loadingOverlay"/>

            <Set Target="lblFact1" Property="Text" Value="ðŸ“‹ All Facts Response:"/>
            <Set Target="lblFact1" Property="Foreground" Value="#E94560"/>
            <Set Target="lblFact2" Property="Text" Value="{httpResult}"/>
            <Set Target="lblFact2" Property="Foreground" Value="#AAAAAA"/>
            <Set Target="lblFact3" Property="Text" Value=""/>
            <Set Target="lblFact4" Property="Text" Value=""/>
            <Set Target="lblFact5" Property="Text" Value=""/>

            <Set Var="factCount" Value="1"/>
            <Set Target="lblCount" Property="Text" Value="ALL"/>

            <Set Target="lblStatus" Property="Text" Value="All facts loaded!"/>
            <Set Target="lblStatus" Property="Foreground" Value="#53D769"/>

            <ScrollToBottom Control="scrollFacts"/>
        </Handler>

        <!-- Clear -->
        <Handler Name="OnClear">
            <Set Var="factCount" Value="0"/>
            <Set Var="httpResult" Value=""/>
            <Set Target="lblCount" Property="Text" Value="0"/>
            <Set Target="lblFact1" Property="Text" Value=""/>
            <Set Target="lblFact2" Property="Text" Value=""/>
            <Set Target="lblFact3" Property="Text" Value=""/>
            <Set Target="lblFact4" Property="Text" Value=""/>
            <Set Target="lblFact5" Property="Text" Value=""/>
            <Set Target="lblLastResponse" Property="Text" Value="none"/>
            <Show Control="welcomeCard"/>
            <Set Target="lblStatus" Property="Text" Value="Cleared - Ready"/>
            <Set Target="lblStatus" Property="Foreground" Value="#53D769"/>
        </Handler>
    </Logic>
</App>