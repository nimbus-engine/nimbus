<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plugin System - Nimbus Framework v3.0</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <link rel="stylesheet" href="style.css">
    
    <style>
        .plugin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .plugin-card {
            background: var(--md-sys-color-surface-container);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: transform 0.2s, border-color 0.2s;
        }
        
        .plugin-card:hover {
            transform: translateY(-4px);
            border-color: var(--md-sys-color-primary);
        }
        
        .plugin-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .plugin-icon {
            width: 40px; height: 40px;
            background: rgba(96, 205, 255, 0.1);
            color: var(--md-sys-color-primary);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        
        .plugin-name {
            font-weight: bold;
            font-size: 16px;
        }
        
        .plugin-funcs {
            font-size: 13px;
            color: var(--md-sys-color-on-surface-variant);
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <div class="layout">
        
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <span class="material-symbols-rounded logo-icon">thunderstorm</span>
                    <span>Nimbus</span>
                </a>
                <button class="icon-btn close-sidebar-btn" id="closeSidebar">
                    <span class="material-symbols-rounded">menu_open</span>
                </button>
            </div>

            <div class="version-control">
                <label>Version</label>
                <div class="select-wrapper">
                    <select id="versionSelect">
                        <option value="../v3/" selected>v3.0 (Latest)</option>
                        <option value="../v2/">v2.0</option>
                        <option value="../v1/">v1.0</option>
                    </select>
                    <span class="material-symbols-rounded select-arrow">expand_more</span>
                </div>
            </div>

            <nav class="nav-menu"></nav> <!-- JS Populates this -->
        </aside>

        <!-- MAIN CONTENT -->
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="top-bar-left">
                    <button class="icon-btn menu-btn" id="openSidebar">
                        <span class="material-symbols-rounded">menu</span>
                    </button>
                    <span class="page-title">Plugin System</span>
                </div>
                <div class="top-bar-right">
                    <a href="https://github.com/modderboyy/nimbus-engine" target="_blank" class="icon-btn github-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                    </a>
                    <button class="icon-btn theme-toggle" id="themeToggle">
                        <span class="material-symbols-rounded theme-icon-light">light_mode</span>
                        <span class="material-symbols-rounded theme-icon-dark">dark_mode</span>
                    </button>
                </div>
            </header>

            <main class="content">
                <div class="content-container">
                    
                    <div class="hero-block">
                        <h1>Plugin System</h1>
                        <p class="lead">Extend Nimbus with powerful built-in plugins or create your own using C# and XML.</p>
                    </div>

                    <div class="table-of-contents">
                        <h3>Jump to</h3>
                        <ul>
                            <li><a href="#builtin">Built-in Plugins</a></li>
                            <li><a href="#usage">How to Use Plugins</a></li>
                            <li><a href="#custom-cs">Creating C# Plugins</a></li>
                            <li><a href="#custom-xml">Creating XML Plugins</a></li>
                            <li><a href="#api">Plugin API</a></li>
                        </ul>
                    </div>

                    <hr class="divider">

                    <!-- BUILT-IN -->
                    <h2 id="builtin">1. Built-in Plugins</h2>
                    <p>Nimbus comes with a rich set of plugins ready to use. These cover everything from math to network requests.</p>

                    <div class="plugin-grid">
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üî¢</div>
                                <span class="plugin-name">MathPlugin</span>
                            </div>
                            <div class="plugin-funcs">abs, min, max, pow, sqrt, round, random, floor, ceil, sin, cos, pi</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üìù</div>
                                <span class="plugin-name">StringPlugin</span>
                            </div>
                            <div class="plugin-funcs">upper, lower, trim, length, contains, replace, repeat, padleft</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üìÖ</div>
                                <span class="plugin-name">DatePlugin</span>
                            </div>
                            <div class="plugin-funcs">now, today, time, year, month, day, timestamp, format</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üìÅ</div>
                                <span class="plugin-name">FilePlugin</span>
                            </div>
                            <div class="plugin-funcs">read, write, exists, delete, size, extension, directory, append</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üîê</div>
                                <span class="plugin-name">CryptoPlugin</span>
                            </div>
                            <div class="plugin-funcs">md5, sha256, guid, shortid</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üìã</div>
                                <span class="plugin-name">JsonPlugin</span>
                            </div>
                            <div class="plugin-funcs">get, count, has</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üåê</div>
                                <span class="plugin-name">NetPlugin</span>
                            </div>
                            <div class="plugin-funcs">urlencode, urldecode, base64encode, download</div>
                        </div>
                        <div class="plugin-card">
                            <div class="plugin-header">
                                <div class="plugin-icon">üí¨</div>
                                <span class="plugin-name">DialogPlugin</span>
                            </div>
                            <div class="plugin-funcs">input, folder (Open dialogs)</div>
                        </div>
                    </div>

                    <hr class="divider">

                    <!-- USAGE -->
                    <h2 id="usage">2. How to Use Plugins</h2>
                    <p>There are two ways to use plugins: calling functions that return values, or executing commands.</p>

                    <h3>Calling Functions</h3>
                    <p>Use the <code>&lt;Plugin&gt;</code> tag to execute a method and store the result in a variable.</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">App.xml</span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <span class="material-symbols-rounded">content_copy</span>
                            </button>
                        </div>
                        <pre><code>&lt;!-- Calculate Square Root --&gt;
&lt;Plugin Name="MathPlugin" Method="sqrt" Params="16" ToState="result"/&gt;

&lt;!-- Get String Length --&gt;
&lt;Plugin Name="StringPlugin" Method="length" Params="Hello" ToState="len"/&gt;

&lt;!-- Generate GUID --&gt;
&lt;Plugin Name="CryptoPlugin" Method="guid" ToState="myId"/&gt;</code></pre>
                    </div>

                    <h3>Executing Commands</h3>
                    <p>Some plugins register custom XML commands. For example, <code>FilePlugin</code> adds <code>&lt;file.write&gt;</code>.</p>

                    <div class="code-block">
                        <pre><code>&lt;!-- Using Command --&gt;
&lt;file.write Path="log.txt" Content="System started"/&gt;

&lt;!-- Using Dialog --&gt;
&lt;dialog.input Title="Enter Name" Message="Who are you?" ToState="username"/&gt;

&lt;!-- Using UI Helper --&gt;
&lt;ui.toast Message="Operation Complete"/&gt;</code></pre>
                    </div>

                    <hr class="divider">

                    <!-- CUSTOM C# -->
                    <h2 id="custom-cs">3. Creating C# Plugins</h2>
                    <p>You can create powerful plugins by writing a C# class that implements <code>INimbusPlugin</code>. Save your file in the `plugins/` folder.</p>

                    <div class="callout callout-info">
                        <span class="material-symbols-rounded callout-icon">folder</span>
                        <div class="callout-body">
                            <strong>Location:</strong> Place your `.cs` files in the `plugins/` folder next to `App.xml`. Nimbus compiles them automatically at runtime.
                        </div>
                    </div>

                    <h3>Example: Greeting Plugin</h3>
                    <p>Create `plugins/MyPlugin.cs`:</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">plugins/MyPlugin.cs</span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <span class="material-symbols-rounded">content_copy</span>
                            </button>
                        </div>
                        <pre><code>using System;
using System.Xml;
using Nimbus.WPF; // Core framework namespace

public class MyPlugin : INimbusPlugin
{
    // Metadata
    public string Name { get { return "MyPlugin"; } }
    public string Version { get { return "1.0"; } }
    public string Description { get { return "A custom greeting plugin"; } }

    public void OnLoad(WpfEngine engine)
    {
        // 1. Register a Function (returns string)
        engine.RegisterFunction("myplugin.greet", delegate(string args)
        {
            return "Hello, " + args + "!";
        });

        // 2. Register a Command (performs action)
        engine.RegisterCommand("myplugin.log", delegate(XmlNode node, object sender)
        {
            string msg = node.Attributes["Message"].Value;
            engine.Log("MY_PLUGIN", msg);
            return true;
        });
    }

    public void OnUnload(WpfEngine engine) 
    {
        // Cleanup logic if needed
    }

    public void OnEvent(WpfEngine engine, string eventName, object data) 
    {
        // Listen to engine events
    }
}</code></pre>
                    </div>

                    <h3>Using Your C# Plugin</h3>
                    <div class="code-block">
                        <pre><code>&lt;!-- Call Function --&gt;
&lt;Plugin Name="MyPlugin" Method="greet" Params="World" ToState="greeting"/&gt;

&lt;!-- Call Command --&gt;
&lt;myplugin.log Message="Custom log message"/&gt;</code></pre>
                    </div>

                    <hr class="divider">

                    <!-- CUSTOM XML -->
                    <h2 id="custom-xml">4. Creating XML Plugins</h2>
                    <p>For simpler logic, you can create "Logic Plugins" using purely XML. This is great for reusable handler libraries.</p>

                    <h3>Example: Auth Plugin</h3>
                    <p>Create `plugins/Auth.xml`:</p>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">plugins/Auth.xml</span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <span class="material-symbols-rounded">content_copy</span>
                            </button>
                        </div>
                        <pre><code>&lt;NimbusPlugin Name="AuthPlugin" Version="1.0"&gt;
    
    &lt;Handlers&gt;
        &lt;Handler Name="Login"&gt;
            &lt;!-- Simulated login logic --&gt;
            &lt;If Condition="{username} == 'admin' AND {password} == '123'"&gt;
                &lt;Set Var="isLoggedIn" Value="true"/&gt;
                &lt;Toast Message="Login Successful!" Type="Success"/&gt;
            &lt;Else&gt;
                &lt;Set Var="isLoggedIn" Value="false"/&gt;
                &lt;Alert Message="Invalid credentials"/&gt;
            &lt;/Else&gt;
            &lt;/If&gt;
        &lt;/Handler&gt;
        
        &lt;Handler Name="Logout"&gt;
            &lt;Set Var="isLoggedIn" Value="false"/&gt;
            &lt;Toast Message="Logged out"/&gt;
        &lt;/Handler&gt;
    &lt;/Handlers&gt;

    &lt;!-- Expose commands to App.xml --&gt;
    &lt;Commands&gt;
        &lt;Command Name="auth.login" Handler="Login"/&gt;
        &lt;Command Name="auth.logout" Handler="Logout"/&gt;
    &lt;/Commands&gt;

&lt;/NimbusPlugin&gt;</code></pre>
                    </div>

                    <h3>Using Your XML Plugin</h3>
                    <p>Nimbus automatically loads `.xml` files in the `plugins/` folder.</p>
                    <div class="code-block">
                        <pre><code>&lt;!-- Use the custom command directly --&gt;
&lt;auth.login/&gt;

&lt;!-- Or call via Plugin tag --&gt;
&lt;Plugin Name="AuthPlugin" Method="Logout"/&gt;</code></pre>
                    </div>

                    <hr class="divider">

                    <!-- API -->
                    <h2 id="api">5. Plugin API Reference</h2>
                    <p>Methods available to C# plugins via the `WpfEngine` instance.</p>

                    <table class="api-table">
                        <thead>
                            <tr><th>Method</th><th>Description</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>engine.RegisterFunction(name, func)</code></td><td>Register a string-returning function (e.g., `math.abs`).</td></tr>
                            <tr><td><code>engine.RegisterCommand(name, handler)</code></td><td>Register a void-returning command (e.g., `file.write`).</td></tr>
                            <tr><td><code>engine.SetVariable(name, value)</code></td><td>Set a state variable.</td></tr>
                            <tr><td><code>engine.GetVariable(name)</code></td><td>Get a state variable value.</td></tr>
                            <tr><td><code>engine.GetControl(name)</code></td><td>Get a WPF control reference.</td></tr>
                            <tr><td><code>engine.Log(level, message)</code></td><td>Write to DevTools log.</td></tr>
                            <tr><td><code>engine.ExecuteHandler(name)</code></td><td>Run another handler by name.</td></tr>
                        </tbody>
                    </table>

                    <div class="navigation-footer">
                        <a href="manual-c.html" class="nav-btn prev">
                            <span class="material-symbols-rounded">arrow_back</span>
                            <span class="nav-text">
                                <span class="nav-subtitle">Previous</span>
                                <span class="nav-title">ManualC (C#)</span>
                            </span>
                        </a>
                        <a href="devtools.html" class="nav-btn next">
                            <span class="nav-text">
                                <span class="nav-subtitle">Next</span>
                                <span class="nav-title">DevTools</span>
                            </span>
                            <span class="material-symbols-rounded">arrow_forward</span>
                        </a>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
